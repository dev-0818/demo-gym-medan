import{d as ae,s as se,r as re,M as E,c as i,a as t,g as q,f as p,v as D,H as y,b as ne,F as M,l as C,x as n,e as S,j as U,k as oe,h as c,m as $,o as l,t as d,D as F,n as O,E as L,N as ie,C as le,w as de,O as ue}from"./index-BL-rMMGy.js";import{_ as pe}from"./ModalDialog.vue_vue_type_script_setup_true_lang-OzfDBMd-.js";import{u as me,_ as ge}from"./usePermissions-DyVJ02aV.js";import{u as ce,_ as ve}from"./usePagination-Bdidk1gz.js";import{u as be}from"./packages-86N227Tj.js";import{u as xe}from"./memberships-Dm9SGUk7.js";import{u as ke}from"./pt-D2Orkp7Z.js";import{u as fe}from"./activityLog-BjSRnBzQ.js";const ye={class:"space-y-6"},Ie={class:"card p-4"},he={class:"flex flex-col gap-3 sm:flex-row"},Pe={class:"card overflow-hidden"},we={class:"overflow-x-auto"},De={class:"w-full text-sm"},Me={class:"divide-y divide-gray-100 dark:divide-gray-700"},Ce={class:"px-5 py-3.5 font-medium text-gray-900 dark:text-gray-100"},Se={class:"px-5 py-3.5 text-gray-600 dark:text-gray-400"},Te={key:0,class:"inline-flex items-center rounded-full bg-orange-100 dark:bg-orange-900/30 px-1.5 py-0.5 text-[10px] font-medium text-orange-700 dark:text-orange-400 ml-1"},_e={class:"px-5 py-3.5 text-gray-600 dark:text-gray-400"},Ve={key:0},Be={key:1,class:"text-gray-400"},Ne={class:"px-5 py-3.5 text-gray-600 dark:text-gray-400"},Ue={class:"px-5 py-3.5 text-gray-600 dark:text-gray-400"},$e={class:"px-5 py-3.5"},Le={key:1,class:"text-sm text-gray-400"},je={class:"px-5 py-3.5"},ze={class:"px-5 py-3.5"},He={class:"flex items-center justify-end gap-1"},Ae=["onClick"],Ee=["onClick"],qe={key:0},Fe={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},Oe=["disabled"],Ge=["value"],Ke=["value"],Re={key:0},Ye=["value"],Je={class:"text-xs text-orange-600 dark:text-orange-400 mt-1 font-medium"},Qe={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},We={class:"flex justify-end gap-3 pt-2"},Xe={type:"submit",class:"btn-primary"},lt=ae({__name:"MembershipsView",setup(Ze){const m=se(),I=fe(),v=be(),f=xe(),T=ke(),{canDelete:G}=me(),_=c(""),h=c("all"),b=c(!1),V=c(!1),j=c(""),P=c(""),g=c(null),r=re({memberId:"",packageId:"",trainerId:"",startDate:E(),endDate:"",status:"active",notes:""}),z=$(()=>{let s=f.memberships;h.value!=="all"&&(s=s.filter(a=>a.status===h.value));const e=_.value.toLowerCase();return e&&(s=s.filter(a=>{const o=m.getUserById(a.memberId);return(o==null?void 0:o.name.toLowerCase().includes(e))||(o==null?void 0:o.email.toLowerCase().includes(e))})),s}),u=ce(z,30),K=u.paginatedItems;function R(s){var e;return((e=m.getUserById(s))==null?void 0:e.name)||"-"}function Y(s){var e;return((e=v.getPackageById(s))==null?void 0:e.name)||"-"}function J(s){var e;return s&&((e=m.getUserById(s))==null?void 0:e.name)||"-"}function B(s){const e=v.getPackageById(s);if(!e)return null;const a=e.features.find(x=>/\d+x\s*sesi\s*personal\s*trainer/i.test(x));if(!a)return null;const o=a.match(/(\d+)/);return o?parseInt(o[1]):null}const N=$(()=>{if(!r.packageId)return!1;const s=v.getPackageById(r.packageId);return s?s.name.toLowerCase().includes("pt")||s.features.some(e=>e.toLowerCase().includes("personal trainer")):!1}),Q=$(()=>B(r.packageId)||0);function H(){const s=v.getPackageById(r.packageId);s&&r.startDate&&(r.endDate=ue(r.startDate,s.durationDays)),N.value||(r.trainerId="")}function W(){g.value=null,Object.assign(r,{memberId:"",packageId:"",trainerId:"",startDate:E(),endDate:"",status:"active",notes:""}),b.value=!0}function X(s){g.value=s,Object.assign(r,{memberId:s.memberId,packageId:s.packageId,trainerId:s.trainerId||"",startDate:s.startDate,endDate:s.endDate,status:s.status,notes:s.notes}),b.value=!0}function Z(){var a;const s={memberId:r.memberId,packageId:r.packageId,trainerId:r.trainerId||void 0,startDate:r.startDate,endDate:r.endDate,status:r.status,notes:r.notes},e=((a=m.getUserById(s.memberId))==null?void 0:a.name)||"member";if(g.value)f.updateMembership(g.value.id,s),I.addLog({action:"update",targetType:"membership",targetId:g.value.id,targetName:e,details:`Mengupdate membership "${e}"`});else if(f.addMembership(s),I.addLog({action:"create",targetType:"membership",targetId:"",targetName:e,details:`Menambahkan membership baru untuk "${e}"`}),N.value&&s.trainerId){const o=v.getPackageById(s.packageId);let x=8;if(o){const k=o.features.find(w=>/\d+x\s*sesi\s*personal\s*trainer/i.test(w));if(k){const w=k.match(/(\d+)/);w&&(x=parseInt(w[1]))}}const A=T.activePTPackages.find(k=>k.sessions===x)||T.activePTPackages[0];if(A){const k=T.addSubscription({memberId:s.memberId,trainerId:s.trainerId,ptPackageId:A.id,totalSessions:x,usedSessions:0,status:"active",startDate:s.startDate,endDate:s.endDate,notes:`Otomatis dari paket ${(o==null?void 0:o.name)||"membership"}`});I.addLog({action:"create",targetType:"pt-subscription",targetId:k.id,targetName:e,details:`Otomatis menambahkan ${x} sesi PT untuk "${e}" dari paket membership`})}}b.value=!1}function ee(s){var a;const e=((a=m.getUserById(s.memberId))==null?void 0:a.name)||"member";j.value=`Yakin hapus membership "${e}"? Data yang sudah dihapus tidak bisa dikembalikan.`,P.value=s.id,V.value=!0}function te(){var a;const s=f.memberships.find(o=>o.id===P.value),e=s&&((a=m.getUserById(s.memberId))==null?void 0:a.name)||"member";I.addLog({action:"delete",targetType:"membership",targetId:P.value,targetName:e,details:`Menghapus membership "${e}"`}),f.deleteMembership(P.value)}return(s,e)=>(l(),i("div",ye,[t("div",{class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between"},[e[13]||(e[13]=t("div",null,[t("h1",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},"Membership"),t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Kelola membership member dengan tanggal mulai & berakhir")],-1)),t("button",{onClick:W,class:"btn-primary"},[...e[12]||(e[12]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1),q(" Tambah Membership ",-1)])])]),t("div",Ie,[t("div",he,[p(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>_.value=a),type:"text",class:"input flex-1",placeholder:"ðŸ” Cari member..."},null,512),[[D,_.value]]),p(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>h.value=a),class:"select w-full sm:w-48"},[...e[14]||(e[14]=[ne('<option value="all">Semua Status</option><option value="active">Aktif</option><option value="expired">Expired</option><option value="pending">Pending</option><option value="frozen">Frozen</option>',5)])],512),[[y,h.value]])])]),t("div",Pe,[t("div",we,[t("table",De,[e[18]||(e[18]=t("thead",null,[t("tr",{class:"border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50 text-left"},[t("th",{class:"px-5 py-3.5 font-semibold text-gray-600 dark:text-gray-400"},"Member"),t("th",{class:"px-5 py-3.5 font-semibold text-gray-600 dark:text-gray-400"},"Paket"),t("th",{class:"px-5 py-3.5 font-semibold text-gray-600 dark:text-gray-400"},"Trainer"),t("th",{class:"px-5 py-3.5 font-semibold text-gray-600 dark:text-gray-400"},"Mulai"),t("th",{class:"px-5 py-3.5 font-semibold text-gray-600 dark:text-gray-400"},"Berakhir"),t("th",{class:"px-5 py-3.5 font-semibold text-gray-600 dark:text-gray-400"},"Sisa"),t("th",{class:"px-5 py-3.5 font-semibold text-gray-600 dark:text-gray-400"},"Status"),t("th",{class:"px-5 py-3.5 font-semibold text-gray-600 dark:text-gray-400 text-right"},"Aksi")])],-1)),t("tbody",Me,[(l(!0),i(M,null,C(n(K),a=>(l(),i("tr",{key:a.id,class:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors"},[t("td",Ce,d(R(a.memberId)),1),t("td",Se,[q(d(Y(a.packageId))+" ",1),B(a.packageId)?(l(),i("span",Te,d(B(a.packageId))+" sesi PT",1)):S("",!0)]),t("td",_e,[a.trainerId?(l(),i("span",Ve,d(J(a.trainerId)),1)):(l(),i("span",Be,"-"))]),t("td",Ne,d(n(F)(a.startDate)),1),t("td",Ue,d(n(F)(a.endDate)),1),t("td",$e,[a.status==="active"?(l(),i("span",{key:0,class:O(["text-sm font-medium",n(L)(a.endDate)<=7?"text-red-600":"text-emerald-600"])},d(n(L)(a.endDate)>0?`${n(L)(a.endDate)} hari`:"Habis"),3)):(l(),i("span",Le,"-"))]),t("td",je,[t("span",{class:O(["inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium capitalize",n(ie)(a.status)])},d(a.status),3)]),t("td",ze,[t("div",He,[t("button",{onClick:o=>X(a),class:"btn-ghost btn-xs",title:"Edit"},[...e[15]||(e[15]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,Ae),n(G)?(l(),i("button",{key:0,onClick:o=>ee(a),class:"btn-ghost btn-xs text-red-500 hover:text-red-700",title:"Hapus"},[...e[16]||(e[16]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Ee)):S("",!0)])])]))),128)),z.value.length===0?(l(),i("tr",qe,[...e[17]||(e[17]=[t("td",{colspan:"8",class:"px-5 py-12 text-center text-gray-500 dark:text-gray-400"},"Tidak ada membership ditemukan.",-1)])])):S("",!0)])])]),U(ve,{"current-page":n(u).currentPage.value,"total-pages":n(u).totalPages.value,"total-items":n(u).totalItems.value,"start-index":n(u).startIndex.value,"end-index":n(u).endIndex.value,"visible-pages":n(u).visiblePages.value,label:"membership",onGoToPage:n(u).goToPage,onPrev:n(u).prevPage,onNext:n(u).nextPage},null,8,["current-page","total-pages","total-items","start-index","end-index","visible-pages","onGoToPage","onPrev","onNext"])]),U(pe,{modelValue:b.value,"onUpdate:modelValue":e[10]||(e[10]=a=>b.value=a),title:g.value?"Edit Membership":"Tambah Membership",size:"lg"},{default:oe(()=>[t("form",{onSubmit:de(Z,["prevent"]),class:"space-y-4"},[t("div",Fe,[t("div",null,[e[20]||(e[20]=t("label",{class:"label"},"Member",-1)),p(t("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>r.memberId=a),class:"select",required:"",disabled:!!g.value},[e[19]||(e[19]=t("option",{value:""},"Pilih member",-1)),(l(!0),i(M,null,C(n(m).members,a=>(l(),i("option",{key:a.id,value:a.id},d(a.name),9,Ge))),128))],8,Oe),[[y,r.memberId]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"label"},"Paket",-1)),p(t("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>r.packageId=a),class:"select",required:"",onChange:H},[e[21]||(e[21]=t("option",{value:""},"Pilih paket",-1)),(l(!0),i(M,null,C(n(v).activePackages,a=>(l(),i("option",{key:a.id,value:a.id},d(a.name)+" - "+d(n(le)(a.price)),9,Ke))),128))],544),[[y,r.packageId]])])]),N.value?(l(),i("div",Re,[e[24]||(e[24]=t("label",{class:"label"},"Personal Trainer",-1)),p(t("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>r.trainerId=a),class:"select",required:""},[e[23]||(e[23]=t("option",{value:""},"Pilih trainer",-1)),(l(!0),i(M,null,C(n(m).trainers.filter(a=>a.isActive),a=>(l(),i("option",{key:a.id,value:a.id},d(a.name),9,Ye))),128))],512),[[y,r.trainerId]]),t("p",Je,"ðŸ‹ï¸ Paket ini termasuk "+d(Q.value)+" sesi Personal Trainer",1)])):S("",!0),t("div",Qe,[t("div",null,[e[25]||(e[25]=t("label",{class:"label"},"Tanggal Mulai",-1)),p(t("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>r.startDate=a),type:"date",class:"input",required:"",onChange:H},null,544),[[D,r.startDate]])]),t("div",null,[e[26]||(e[26]=t("label",{class:"label"},"Tanggal Berakhir",-1)),p(t("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>r.endDate=a),type:"date",class:"input",required:""},null,512),[[D,r.endDate]])])]),t("div",null,[e[28]||(e[28]=t("label",{class:"label"},"Status",-1)),p(t("select",{"onUpdate:modelValue":e[7]||(e[7]=a=>r.status=a),class:"select"},[...e[27]||(e[27]=[t("option",{value:"active"},"Aktif",-1),t("option",{value:"pending"},"Pending",-1),t("option",{value:"expired"},"Expired",-1),t("option",{value:"frozen"},"Frozen",-1)])],512),[[y,r.status]])]),t("div",null,[e[29]||(e[29]=t("label",{class:"label"},"Catatan",-1)),p(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=a=>r.notes=a),class:"input",rows:"2",placeholder:"Catatan tambahan..."},null,512),[[D,r.notes]])]),t("div",We,[t("button",{type:"button",onClick:e[9]||(e[9]=a=>b.value=!1),class:"btn-secondary"},"Batal"),t("button",Xe,d(g.value?"Simpan":"Tambah"),1)])],32)]),_:1},8,["modelValue","title"]),U(ge,{modelValue:V.value,"onUpdate:modelValue":e[11]||(e[11]=a=>V.value=a),message:j.value,onConfirm:te},null,8,["modelValue","message"])]))}});export{lt as default};
