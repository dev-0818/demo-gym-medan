import{d as te,s as ae,r as se,P as O,c as i,a as t,g as le,t as n,x as l,C as T,f as m,v as S,H as x,b as q,F as D,l as _,e as c,j as C,k as U,h as p,m as A,o as d,Q as z,n as H,N as F,D as B,w as Q,S as oe}from"./index-BL-rMMGy.js";import{_ as R}from"./ModalDialog.vue_vue_type_script_setup_true_lang-OzfDBMd-.js";import{u as ne,_ as re}from"./usePermissions-DyVJ02aV.js";import{u as ie,_ as de}from"./usePagination-Bdidk1gz.js";import{u as ue}from"./memberships-Dm9SGUk7.js";import{u as me}from"./payments-BNnbHALE.js";import{u as pe}from"./activityLog-BjSRnBzQ.js";const ge={class:"space-y-6"},ve={class:"grid grid-cols-1 gap-4 sm:grid-cols-3"},ye={class:"card p-4 text-center"},xe={class:"text-xl font-bold text-gray-900 dark:text-gray-100"},be={class:"card p-4 text-center"},fe={class:"text-xl font-bold text-emerald-600"},ce={class:"card p-4 text-center"},ke={class:"text-xl font-bold text-amber-600"},we={class:"card p-4"},Pe={class:"flex flex-col gap-3 sm:flex-row"},Ie={class:"card overflow-hidden"},he={class:"overflow-x-auto"},Se={class:"w-full text-sm"},Ce={class:"divide-y divide-gray-100 dark:divide-gray-700"},Me=["onClick"],Ve={class:"px-5 py-3.5 font-mono text-sm text-primary-600 font-medium"},Ne={class:"px-5 py-3.5 font-medium text-gray-900 dark:text-gray-100"},Te={class:"px-5 py-3.5 font-semibold text-gray-900 dark:text-gray-100"},De={class:"px-5 py-3.5 text-gray-600 dark:text-gray-400"},_e={class:"px-5 py-3.5"},Ue={class:"px-5 py-3.5 text-gray-500 dark:text-gray-400"},Ae={class:"px-5 py-3.5"},Be=["onClick"],Le={key:0},$e=["value"],je={key:0},Oe=["value"],qe={class:"grid grid-cols-2 gap-4"},ze={class:"grid grid-cols-2 gap-4"},He={class:"flex justify-end gap-3 pt-2"},Fe={key:0,class:"space-y-4"},Qe={class:"rounded-lg bg-gray-50 dark:bg-gray-700/50 p-4 text-center"},Re={class:"text-3xl font-bold text-gray-900 dark:text-gray-100"},Ge={class:"divide-y divide-gray-100 dark:divide-gray-700"},Je={class:"flex justify-between py-2.5"},Ke={class:"text-sm font-mono font-medium"},Ee={class:"flex justify-between py-2.5"},Ye={class:"text-sm font-medium"},We={class:"flex justify-between py-2.5"},Xe={class:"text-sm"},Ze={class:"flex justify-between py-2.5"},et={class:"flex justify-between py-2.5"},tt={class:"text-sm"},at={key:0,class:"py-2.5"},st={class:"mt-1 text-sm text-gray-700 dark:text-gray-300"},lt={class:"flex justify-center"},gt=te({__name:"PaymentsView",setup(ot){const v=ae(),M=pe(),G=ue(),y=me(),{canDelete:J}=ne(),V=p(""),k=p("all"),w=p("all"),b=p(!1),N=p(!1),L=p(""),P=p(""),f=p(null),I=p(!1),r=p(null),o=se({memberId:"",membershipId:"",amount:0,method:"cash",status:"paid",notes:"",paidAt:O().slice(0,16)}),h=A(()=>{let s=[...y.payments].sort((a,g)=>new Date(g.createdAt).getTime()-new Date(a.createdAt).getTime());k.value!=="all"&&(s=s.filter(a=>a.status===k.value)),w.value!=="all"&&(s=s.filter(a=>a.method===w.value));const e=V.value.toLowerCase();return e&&(s=s.filter(a=>{const g=v.getUserById(a.memberId);return(g==null?void 0:g.name.toLowerCase().includes(e))||a.invoiceNumber.toLowerCase().includes(e)})),s}),u=ie(h,30),K=u.paginatedItems,$=A(()=>o.memberId?G.getMembershipsByMember(o.memberId):[]);function j(s){var e;return((e=v.getUserById(s))==null?void 0:e.name)||"-"}function E(){f.value=null,Object.assign(o,{memberId:"",membershipId:"",amount:0,method:"cash",status:"paid",notes:"",paidAt:O().slice(0,16)}),b.value=!0}function Y(s){r.value=s,I.value=!0}function W(){var e;const s=((e=v.getUserById(o.memberId))==null?void 0:e.name)||"member";if(f.value)y.updatePayment(f.value.id,{...o,paidAt:new Date(o.paidAt).toISOString()}),M.addLog({action:"update",targetType:"payment",targetId:f.value.id,targetName:s,details:`Mengupdate pembayaran ${f.value.invoiceNumber} (${s})`});else{const a=y.addPayment({...o,paidAt:new Date(o.paidAt).toISOString()});M.addLog({action:"create",targetType:"payment",targetId:a.id,targetName:s,details:`Menambahkan pembayaran baru untuk "${s}"`})}b.value=!1}function X(s){var a;const e=((a=v.getUserById(s.memberId))==null?void 0:a.name)||"member";L.value=`Yakin hapus pembayaran ${s.invoiceNumber} (${e})? Data yang sudah dihapus tidak bisa dikembalikan.`,P.value=s.id,N.value=!0}function Z(){var a;const s=y.payments.find(g=>g.id===P.value),e=s&&((a=v.getUserById(s.memberId))==null?void 0:a.name)||"member";M.addLog({action:"delete",targetType:"payment",targetId:P.value,targetName:e,details:`Menghapus pembayaran ${(s==null?void 0:s.invoiceNumber)||""} (${e})`}),y.deletePayment(P.value)}const ee=A(()=>h.value.reduce((s,e)=>s+e.amount,0));return(s,e)=>(d(),i("div",ge,[t("div",{class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between"},[e[17]||(e[17]=t("div",null,[t("h1",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},"Pembayaran"),t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Kelola pembayaran dan riwayat transaksi")],-1)),t("button",{onClick:E,class:"btn-primary"},[...e[16]||(e[16]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1),le(" Input Pembayaran ",-1)])])]),t("div",ve,[t("div",ye,[e[18]||(e[18]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Total Transaksi",-1)),t("p",xe,n(h.value.length),1)]),t("div",be,[e[19]||(e[19]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Total Nilai",-1)),t("p",fe,n(l(T)(ee.value)),1)]),t("div",ce,[e[20]||(e[20]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Pending",-1)),t("p",ke,n(l(y).pendingPayments.length),1)])]),t("div",we,[t("div",Pe,[m(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>V.value=a),type:"text",class:"input flex-1",placeholder:"ðŸ” Cari member / invoice..."},null,512),[[S,V.value]]),m(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>k.value=a),class:"select w-full sm:w-40"},[...e[21]||(e[21]=[q('<option value="all">Semua Status</option><option value="paid">Lunas</option><option value="pending">Pending</option><option value="overdue">Overdue</option><option value="cancelled">Dibatalkan</option>',5)])],512),[[x,k.value]]),m(t("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>w.value=a),class:"select w-full sm:w-40"},[...e[22]||(e[22]=[q('<option value="all">Semua Metode</option><option value="cash">Cash</option><option value="transfer">Transfer</option><option value="qris">QRIS</option><option value="debit">Debit</option>',5)])],512),[[x,w.value]])])]),t("div",Ie,[t("div",he,[t("table",Se,[e[25]||(e[25]=t("thead",null,[t("tr",{class:"border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50 text-left"},[t("th",{class:"px-5 py-3.5 font-semibold text-gray-600 dark:text-gray-400"},"Invoice"),t("th",{class:"px-5 py-3.5 font-semibold text-gray-600 dark:text-gray-400"},"Member"),t("th",{class:"px-5 py-3.5 font-semibold text-gray-600 dark:text-gray-400"},"Jumlah"),t("th",{class:"px-5 py-3.5 font-semibold text-gray-600 dark:text-gray-400"},"Metode"),t("th",{class:"px-5 py-3.5 font-semibold text-gray-600 dark:text-gray-400"},"Status"),t("th",{class:"px-5 py-3.5 font-semibold text-gray-600 dark:text-gray-400"},"Tanggal"),t("th",{class:"px-5 py-3.5 font-semibold text-gray-600 dark:text-gray-400 text-right"},"Aksi")])],-1)),t("tbody",Ce,[(d(!0),i(D,null,_(l(K),a=>(d(),i("tr",{key:a.id,class:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors cursor-pointer",onClick:g=>Y(a)},[t("td",Ve,n(a.invoiceNumber),1),t("td",Ne,n(j(a.memberId)),1),t("td",Te,n(l(T)(a.amount)),1),t("td",De,n(l(z)(a.method)),1),t("td",_e,[t("span",{class:H(["inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium capitalize",l(F)(a.status)])},n(a.status==="paid"?"Lunas":a.status),3)]),t("td",Ue,n(l(B)(a.paidAt)),1),t("td",Ae,[l(J)?(d(),i("div",{key:0,class:"flex items-center justify-end gap-1",onClick:e[3]||(e[3]=Q(()=>{},["stop"]))},[t("button",{onClick:g=>X(a),class:"btn-ghost btn-xs text-red-500 hover:text-red-700",title:"Hapus"},[...e[23]||(e[23]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Be)])):c("",!0)])],8,Me))),128)),h.value.length===0?(d(),i("tr",Le,[...e[24]||(e[24]=[t("td",{colspan:"7",class:"px-5 py-12 text-center text-gray-500 dark:text-gray-400"},"Tidak ada pembayaran ditemukan.",-1)])])):c("",!0)])])]),C(de,{"current-page":l(u).currentPage.value,"total-pages":l(u).totalPages.value,"total-items":l(u).totalItems.value,"start-index":l(u).startIndex.value,"end-index":l(u).endIndex.value,"visible-pages":l(u).visiblePages.value,label:"pembayaran",onGoToPage:l(u).goToPage,onPrev:l(u).prevPage,onNext:l(u).nextPage},null,8,["current-page","total-pages","total-items","start-index","end-index","visible-pages","onGoToPage","onPrev","onNext"])]),C(R,{modelValue:b.value,"onUpdate:modelValue":e[12]||(e[12]=a=>b.value=a),title:"Input Pembayaran",size:"lg"},{default:U(()=>[t("form",{onSubmit:Q(W,["prevent"]),class:"space-y-4"},[t("div",null,[e[27]||(e[27]=t("label",{class:"label"},"Member",-1)),m(t("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>o.memberId=a),class:"select",required:""},[e[26]||(e[26]=t("option",{value:""},"Pilih member",-1)),(d(!0),i(D,null,_(l(v).members,a=>(d(),i("option",{key:a.id,value:a.id},n(a.name),9,$e))),128))],512),[[x,o.memberId]])]),$.value.length>0?(d(),i("div",je,[e[29]||(e[29]=t("label",{class:"label"},"Membership",-1)),m(t("select",{"onUpdate:modelValue":e[5]||(e[5]=a=>o.membershipId=a),class:"select"},[e[28]||(e[28]=t("option",{value:""},"Pilih membership",-1)),(d(!0),i(D,null,_($.value,a=>(d(),i("option",{key:a.id,value:a.id},n(l(B)(a.startDate))+" - "+n(l(B)(a.endDate))+" ("+n(a.status)+") ",9,Oe))),128))],512),[[x,o.membershipId]])])):c("",!0),t("div",qe,[t("div",null,[e[30]||(e[30]=t("label",{class:"label"},"Jumlah (Rp)",-1)),m(t("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>o.amount=a),type:"number",class:"input",min:"0",required:""},null,512),[[S,o.amount,void 0,{number:!0}]])]),t("div",null,[e[32]||(e[32]=t("label",{class:"label"},"Metode Pembayaran",-1)),m(t("select",{"onUpdate:modelValue":e[7]||(e[7]=a=>o.method=a),class:"select"},[...e[31]||(e[31]=[t("option",{value:"cash"},"Cash",-1),t("option",{value:"transfer"},"Transfer Bank",-1),t("option",{value:"qris"},"QRIS",-1),t("option",{value:"debit"},"Kartu Debit",-1)])],512),[[x,o.method]])])]),t("div",ze,[t("div",null,[e[34]||(e[34]=t("label",{class:"label"},"Status",-1)),m(t("select",{"onUpdate:modelValue":e[8]||(e[8]=a=>o.status=a),class:"select"},[...e[33]||(e[33]=[t("option",{value:"paid"},"Lunas",-1),t("option",{value:"pending"},"Pending",-1),t("option",{value:"overdue"},"Overdue",-1)])],512),[[x,o.status]])]),t("div",null,[e[35]||(e[35]=t("label",{class:"label"},"Tanggal Bayar",-1)),m(t("input",{"onUpdate:modelValue":e[9]||(e[9]=a=>o.paidAt=a),type:"datetime-local",class:"input"},null,512),[[S,o.paidAt]])])]),t("div",null,[e[36]||(e[36]=t("label",{class:"label"},"Catatan",-1)),m(t("textarea",{"onUpdate:modelValue":e[10]||(e[10]=a=>o.notes=a),class:"input",rows:"2",placeholder:"Catatan pembayaran..."},null,512),[[S,o.notes]])]),t("div",He,[t("button",{type:"button",onClick:e[11]||(e[11]=a=>b.value=!1),class:"btn-secondary"},"Batal"),e[37]||(e[37]=t("button",{type:"submit",class:"btn-primary"},"Simpan Pembayaran",-1))])],32)]),_:1},8,["modelValue"]),C(R,{modelValue:I.value,"onUpdate:modelValue":e[14]||(e[14]=a=>I.value=a),title:"Detail Pembayaran",size:"sm"},{footer:U(()=>[t("div",lt,[t("button",{onClick:e[13]||(e[13]=a=>I.value=!1),class:"btn-primary"},"Tutup")])]),default:U(()=>[r.value?(d(),i("div",Fe,[t("div",Qe,[e[38]||(e[38]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Total Pembayaran",-1)),t("p",Re,n(l(T)(r.value.amount)),1)]),t("div",Ge,[t("div",Je,[e[39]||(e[39]=t("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"Invoice",-1)),t("span",Ke,n(r.value.invoiceNumber),1)]),t("div",Ee,[e[40]||(e[40]=t("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"Member",-1)),t("span",Ye,n(j(r.value.memberId)),1)]),t("div",We,[e[41]||(e[41]=t("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"Metode",-1)),t("span",Xe,n(l(z)(r.value.method)),1)]),t("div",Ze,[e[42]||(e[42]=t("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"Status",-1)),t("span",{class:H(["inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium capitalize",l(F)(r.value.status)])},n(r.value.status==="paid"?"Lunas":r.value.status),3)]),t("div",et,[e[43]||(e[43]=t("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"Tanggal",-1)),t("span",tt,n(l(oe)(r.value.paidAt)),1)]),r.value.notes?(d(),i("div",at,[e[44]||(e[44]=t("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"Catatan:",-1)),t("p",st,n(r.value.notes),1)])):c("",!0)])])):c("",!0)]),_:1},8,["modelValue"]),C(re,{modelValue:N.value,"onUpdate:modelValue":e[15]||(e[15]=a=>N.value=a),message:L.value,onConfirm:Z},null,8,["modelValue","message"])]))}});export{gt as default};
