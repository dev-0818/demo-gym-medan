import{d as Z,s as ee,r as te,P as $,c as i,a as t,g as se,t as o,x as n,C as V,f as u,v as S,H as g,b as O,F as D,l as N,e as f,j as T,k as U,h as m,m as _,o as d,Q as q,n as z,N as H,D as A,w as F,S as ae}from"./index-CvLdIzOc.js";import{_ as Q}from"./ModalDialog.vue_vue_type_script_setup_true_lang-FTlyx4lQ.js";import{u as le,_ as oe}from"./usePermissions-C5OhafvI.js";import{u as ne}from"./memberships-Cd367sp8.js";import{u as re}from"./payments-CUgHSblE.js";import{u as ie}from"./activityLog-BmGH0MBl.js";const de={class:"space-y-6"},ue={class:"grid grid-cols-1 gap-4 sm:grid-cols-3"},me={class:"card p-4 text-center"},pe={class:"text-xl font-bold text-gray-900 dark:text-gray-100"},ye={class:"card p-4 text-center"},ve={class:"text-xl font-bold text-emerald-600"},ge={class:"card p-4 text-center"},xe={class:"text-xl font-bold text-amber-600"},be={class:"card p-4"},fe={class:"flex flex-col gap-3 sm:flex-row"},ce={class:"card overflow-hidden"},ke={class:"overflow-x-auto"},we={class:"w-full text-sm"},Ie={class:"divide-y divide-gray-100 dark:divide-gray-700"},he=["onClick"],Se={class:"px-5 py-3.5 font-mono text-sm text-primary-600 font-medium"},Ce={class:"px-5 py-3.5 font-medium text-gray-900 dark:text-gray-100"},Me={class:"px-5 py-3.5 font-semibold text-gray-900 dark:text-gray-100"},Pe={class:"px-5 py-3.5 text-gray-600 dark:text-gray-400"},Ve={class:"px-5 py-3.5"},De={class:"px-5 py-3.5 text-gray-500 dark:text-gray-400"},Ne={class:"px-5 py-3.5"},Te=["onClick"],Ue={key:0},_e=["value"],Ae={key:0},Be=["value"],Le={class:"grid grid-cols-2 gap-4"},je={class:"grid grid-cols-2 gap-4"},$e={class:"flex justify-end gap-3 pt-2"},Oe={key:0,class:"space-y-4"},qe={class:"rounded-lg bg-gray-50 dark:bg-gray-700/50 p-4 text-center"},ze={class:"text-3xl font-bold text-gray-900 dark:text-gray-100"},He={class:"divide-y divide-gray-100 dark:divide-gray-700"},Fe={class:"flex justify-between py-2.5"},Qe={class:"text-sm font-mono font-medium"},Re={class:"flex justify-between py-2.5"},Je={class:"text-sm font-medium"},Ke={class:"flex justify-between py-2.5"},Ee={class:"text-sm"},Ye={class:"flex justify-between py-2.5"},Ge={class:"flex justify-between py-2.5"},We={class:"text-sm"},Xe={key:0,class:"py-2.5"},Ze={class:"mt-1 text-sm text-gray-700 dark:text-gray-300"},et={class:"flex justify-center"},it=Z({__name:"PaymentsView",setup(tt){const y=ee(),C=ie(),R=ne(),v=re(),{canDelete:J}=le(),M=m(""),c=m("all"),k=m("all"),x=m(!1),P=m(!1),B=m(""),w=m(""),b=m(null),I=m(!1),r=m(null),l=te({memberId:"",membershipId:"",amount:0,method:"cash",status:"paid",notes:"",paidAt:$().slice(0,16)}),h=_(()=>{let a=[...v.payments].sort((s,p)=>new Date(p.createdAt).getTime()-new Date(s.createdAt).getTime());c.value!=="all"&&(a=a.filter(s=>s.status===c.value)),k.value!=="all"&&(a=a.filter(s=>s.method===k.value));const e=M.value.toLowerCase();return e&&(a=a.filter(s=>{const p=y.getUserById(s.memberId);return(p==null?void 0:p.name.toLowerCase().includes(e))||s.invoiceNumber.toLowerCase().includes(e)})),a}),L=_(()=>l.memberId?R.getMembershipsByMember(l.memberId):[]);function j(a){var e;return((e=y.getUserById(a))==null?void 0:e.name)||"-"}function K(){b.value=null,Object.assign(l,{memberId:"",membershipId:"",amount:0,method:"cash",status:"paid",notes:"",paidAt:$().slice(0,16)}),x.value=!0}function E(a){r.value=a,I.value=!0}function Y(){var e;const a=((e=y.getUserById(l.memberId))==null?void 0:e.name)||"member";if(b.value)v.updatePayment(b.value.id,{...l,paidAt:new Date(l.paidAt).toISOString()}),C.addLog({action:"update",targetType:"payment",targetId:b.value.id,targetName:a,details:`Mengupdate pembayaran ${b.value.invoiceNumber} (${a})`});else{const s=v.addPayment({...l,paidAt:new Date(l.paidAt).toISOString()});C.addLog({action:"create",targetType:"payment",targetId:s.id,targetName:a,details:`Menambahkan pembayaran baru untuk "${a}"`})}x.value=!1}function G(a){var s;const e=((s=y.getUserById(a.memberId))==null?void 0:s.name)||"member";B.value=`Yakin hapus pembayaran ${a.invoiceNumber} (${e})? Data yang sudah dihapus tidak bisa dikembalikan.`,w.value=a.id,P.value=!0}function W(){var s;const a=v.payments.find(p=>p.id===w.value),e=a&&((s=y.getUserById(a.memberId))==null?void 0:s.name)||"member";C.addLog({action:"delete",targetType:"payment",targetId:w.value,targetName:e,details:`Menghapus pembayaran ${(a==null?void 0:a.invoiceNumber)||""} (${e})`}),v.deletePayment(w.value)}const X=_(()=>h.value.reduce((a,e)=>a+e.amount,0));return(a,e)=>(d(),i("div",de,[t("div",{class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between"},[e[17]||(e[17]=t("div",null,[t("h1",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},"Pembayaran"),t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Kelola pembayaran dan riwayat transaksi")],-1)),t("button",{onClick:K,class:"btn-primary"},[...e[16]||(e[16]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1),se(" Input Pembayaran ",-1)])])]),t("div",ue,[t("div",me,[e[18]||(e[18]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Total Transaksi",-1)),t("p",pe,o(h.value.length),1)]),t("div",ye,[e[19]||(e[19]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Total Nilai",-1)),t("p",ve,o(n(V)(X.value)),1)]),t("div",ge,[e[20]||(e[20]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Pending",-1)),t("p",xe,o(n(v).pendingPayments.length),1)])]),t("div",be,[t("div",fe,[u(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>M.value=s),type:"text",class:"input flex-1",placeholder:"ðŸ” Cari member / invoice..."},null,512),[[S,M.value]]),u(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>c.value=s),class:"select w-full sm:w-40"},[...e[21]||(e[21]=[O('<option value="all">Semua Status</option><option value="paid">Lunas</option><option value="pending">Pending</option><option value="overdue">Overdue</option><option value="cancelled">Dibatalkan</option>',5)])],512),[[g,c.value]]),u(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>k.value=s),class:"select w-full sm:w-40"},[...e[22]||(e[22]=[O('<option value="all">Semua Metode</option><option value="cash">Cash</option><option value="transfer">Transfer</option><option value="qris">QRIS</option><option value="debit">Debit</option>',5)])],512),[[g,k.value]])])]),t("div",ce,[t("div",ke,[t("table",we,[e[25]||(e[25]=t("thead",null,[t("tr",{class:"border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50 text-left"},[t("th",{class:"px-5 py-3.5 font-semibold text-gray-600 dark:text-gray-400"},"Invoice"),t("th",{class:"px-5 py-3.5 font-semibold text-gray-600 dark:text-gray-400"},"Member"),t("th",{class:"px-5 py-3.5 font-semibold text-gray-600 dark:text-gray-400"},"Jumlah"),t("th",{class:"px-5 py-3.5 font-semibold text-gray-600 dark:text-gray-400"},"Metode"),t("th",{class:"px-5 py-3.5 font-semibold text-gray-600 dark:text-gray-400"},"Status"),t("th",{class:"px-5 py-3.5 font-semibold text-gray-600 dark:text-gray-400"},"Tanggal"),t("th",{class:"px-5 py-3.5 font-semibold text-gray-600 dark:text-gray-400 text-right"},"Aksi")])],-1)),t("tbody",Ie,[(d(!0),i(D,null,N(h.value,s=>(d(),i("tr",{key:s.id,class:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors cursor-pointer",onClick:p=>E(s)},[t("td",Se,o(s.invoiceNumber),1),t("td",Ce,o(j(s.memberId)),1),t("td",Me,o(n(V)(s.amount)),1),t("td",Pe,o(n(q)(s.method)),1),t("td",Ve,[t("span",{class:z(["inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium capitalize",n(H)(s.status)])},o(s.status==="paid"?"Lunas":s.status),3)]),t("td",De,o(n(A)(s.paidAt)),1),t("td",Ne,[n(J)?(d(),i("div",{key:0,class:"flex items-center justify-end gap-1",onClick:e[3]||(e[3]=F(()=>{},["stop"]))},[t("button",{onClick:p=>G(s),class:"btn-ghost btn-xs text-red-500 hover:text-red-700",title:"Hapus"},[...e[23]||(e[23]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Te)])):f("",!0)])],8,he))),128)),h.value.length===0?(d(),i("tr",Ue,[...e[24]||(e[24]=[t("td",{colspan:"7",class:"px-5 py-12 text-center text-gray-500 dark:text-gray-400"},"Tidak ada pembayaran ditemukan.",-1)])])):f("",!0)])])])]),T(Q,{modelValue:x.value,"onUpdate:modelValue":e[12]||(e[12]=s=>x.value=s),title:"Input Pembayaran",size:"lg"},{default:U(()=>[t("form",{onSubmit:F(Y,["prevent"]),class:"space-y-4"},[t("div",null,[e[27]||(e[27]=t("label",{class:"label"},"Member",-1)),u(t("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>l.memberId=s),class:"select",required:""},[e[26]||(e[26]=t("option",{value:""},"Pilih member",-1)),(d(!0),i(D,null,N(n(y).members,s=>(d(),i("option",{key:s.id,value:s.id},o(s.name),9,_e))),128))],512),[[g,l.memberId]])]),L.value.length>0?(d(),i("div",Ae,[e[29]||(e[29]=t("label",{class:"label"},"Membership",-1)),u(t("select",{"onUpdate:modelValue":e[5]||(e[5]=s=>l.membershipId=s),class:"select"},[e[28]||(e[28]=t("option",{value:""},"Pilih membership",-1)),(d(!0),i(D,null,N(L.value,s=>(d(),i("option",{key:s.id,value:s.id},o(n(A)(s.startDate))+" - "+o(n(A)(s.endDate))+" ("+o(s.status)+") ",9,Be))),128))],512),[[g,l.membershipId]])])):f("",!0),t("div",Le,[t("div",null,[e[30]||(e[30]=t("label",{class:"label"},"Jumlah (Rp)",-1)),u(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>l.amount=s),type:"number",class:"input",min:"0",required:""},null,512),[[S,l.amount,void 0,{number:!0}]])]),t("div",null,[e[32]||(e[32]=t("label",{class:"label"},"Metode Pembayaran",-1)),u(t("select",{"onUpdate:modelValue":e[7]||(e[7]=s=>l.method=s),class:"select"},[...e[31]||(e[31]=[t("option",{value:"cash"},"Cash",-1),t("option",{value:"transfer"},"Transfer Bank",-1),t("option",{value:"qris"},"QRIS",-1),t("option",{value:"debit"},"Kartu Debit",-1)])],512),[[g,l.method]])])]),t("div",je,[t("div",null,[e[34]||(e[34]=t("label",{class:"label"},"Status",-1)),u(t("select",{"onUpdate:modelValue":e[8]||(e[8]=s=>l.status=s),class:"select"},[...e[33]||(e[33]=[t("option",{value:"paid"},"Lunas",-1),t("option",{value:"pending"},"Pending",-1),t("option",{value:"overdue"},"Overdue",-1)])],512),[[g,l.status]])]),t("div",null,[e[35]||(e[35]=t("label",{class:"label"},"Tanggal Bayar",-1)),u(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>l.paidAt=s),type:"datetime-local",class:"input"},null,512),[[S,l.paidAt]])])]),t("div",null,[e[36]||(e[36]=t("label",{class:"label"},"Catatan",-1)),u(t("textarea",{"onUpdate:modelValue":e[10]||(e[10]=s=>l.notes=s),class:"input",rows:"2",placeholder:"Catatan pembayaran..."},null,512),[[S,l.notes]])]),t("div",$e,[t("button",{type:"button",onClick:e[11]||(e[11]=s=>x.value=!1),class:"btn-secondary"},"Batal"),e[37]||(e[37]=t("button",{type:"submit",class:"btn-primary"},"Simpan Pembayaran",-1))])],32)]),_:1},8,["modelValue"]),T(Q,{modelValue:I.value,"onUpdate:modelValue":e[14]||(e[14]=s=>I.value=s),title:"Detail Pembayaran",size:"sm"},{footer:U(()=>[t("div",et,[t("button",{onClick:e[13]||(e[13]=s=>I.value=!1),class:"btn-primary"},"Tutup")])]),default:U(()=>[r.value?(d(),i("div",Oe,[t("div",qe,[e[38]||(e[38]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Total Pembayaran",-1)),t("p",ze,o(n(V)(r.value.amount)),1)]),t("div",He,[t("div",Fe,[e[39]||(e[39]=t("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"Invoice",-1)),t("span",Qe,o(r.value.invoiceNumber),1)]),t("div",Re,[e[40]||(e[40]=t("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"Member",-1)),t("span",Je,o(j(r.value.memberId)),1)]),t("div",Ke,[e[41]||(e[41]=t("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"Metode",-1)),t("span",Ee,o(n(q)(r.value.method)),1)]),t("div",Ye,[e[42]||(e[42]=t("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"Status",-1)),t("span",{class:z(["inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium capitalize",n(H)(r.value.status)])},o(r.value.status==="paid"?"Lunas":r.value.status),3)]),t("div",Ge,[e[43]||(e[43]=t("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"Tanggal",-1)),t("span",We,o(n(ae)(r.value.paidAt)),1)]),r.value.notes?(d(),i("div",Xe,[e[44]||(e[44]=t("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"Catatan:",-1)),t("p",Ze,o(r.value.notes),1)])):f("",!0)])])):f("",!0)]),_:1},8,["modelValue"]),T(oe,{modelValue:P.value,"onUpdate:modelValue":e[15]||(e[15]=s=>P.value=s),message:B.value,onConfirm:W},null,8,["modelValue","message"])]))}});export{it as default};
