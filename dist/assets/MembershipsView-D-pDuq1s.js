import{d as O,s as K,r as R,M as B,c as l,a as t,g as Y,f as u,v as k,H as y,b as G,F as f,l as h,e as T,t as o,j as N,k as J,h as g,m as Q,o as n,x as i,D as P,n as _,E as V,N as W,C as X,w as Z,O as ee}from"./index-CvLdIzOc.js";import{_ as te}from"./ModalDialog.vue_vue_type_script_setup_true_lang-FTlyx4lQ.js";import{u as ae,_ as se}from"./usePermissions-C5OhafvI.js";import{u as re}from"./packages-BZayHPwV.js";import{u as le}from"./memberships-Cd367sp8.js";import{u as oe}from"./activityLog-BmGH0MBl.js";const ne={class:"space-y-6"},ie={class:"card p-4"},de={class:"flex flex-col gap-3 sm:flex-row"},ue={class:"card overflow-hidden"},me={class:"overflow-x-auto"},pe={class:"w-full text-sm"},ge={class:"divide-y divide-gray-100 dark:divide-gray-700"},be={class:"px-5 py-3.5 font-medium text-gray-900 dark:text-gray-100"},ve={class:"px-5 py-3.5 text-gray-600 dark:text-gray-400"},ye={class:"px-5 py-3.5 text-gray-600 dark:text-gray-400"},ce={class:"px-5 py-3.5 text-gray-600 dark:text-gray-400"},xe={class:"px-5 py-3.5 text-gray-600 dark:text-gray-400"},ke={class:"px-5 py-3.5"},fe={key:1,class:"text-sm text-gray-400"},he={class:"px-5 py-3.5"},Ie={class:"px-5 py-3.5"},we={class:"flex items-center justify-end gap-1"},De=["onClick"],Me=["onClick"],Ce={key:0},Ve={class:"border-t border-gray-200 dark:border-gray-700 px-5 py-3 text-sm text-gray-500 dark:text-gray-400"},Se={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},Ue=["disabled"],Be=["value"],Te=["value"],Ne=["value"],Pe={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},_e={class:"flex justify-end gap-3 pt-2"},Le={type:"submit",class:"btn-primary"},Fe=O({__name:"MembershipsView",setup($e){const m=K(),I=oe(),w=re(),v=le(),{canDelete:L}=ae(),D=g(""),c=g("all"),b=g(!1),M=g(!1),S=g(""),x=g(""),p=g(null),r=R({memberId:"",packageId:"",trainerId:"",startDate:B(),endDate:"",status:"active",notes:""}),C=Q(()=>{let s=v.memberships;c.value!=="all"&&(s=s.filter(a=>a.status===c.value));const e=D.value.toLowerCase();return e&&(s=s.filter(a=>{const d=m.getUserById(a.memberId);return(d==null?void 0:d.name.toLowerCase().includes(e))||(d==null?void 0:d.email.toLowerCase().includes(e))})),s});function $(s){var e;return((e=m.getUserById(s))==null?void 0:e.name)||"-"}function j(s){var e;return((e=w.getPackageById(s))==null?void 0:e.name)||"-"}function z(s){var e;return s&&((e=m.getUserById(s))==null?void 0:e.name)||"-"}function U(){const s=w.getPackageById(r.packageId);s&&r.startDate&&(r.endDate=ee(r.startDate,s.durationDays))}function E(){p.value=null,Object.assign(r,{memberId:"",packageId:"",trainerId:"",startDate:B(),endDate:"",status:"active",notes:""}),b.value=!0}function H(s){p.value=s,Object.assign(r,{memberId:s.memberId,packageId:s.packageId,trainerId:s.trainerId||"",startDate:s.startDate,endDate:s.endDate,status:s.status,notes:s.notes}),b.value=!0}function A(){var a;const s={memberId:r.memberId,packageId:r.packageId,trainerId:r.trainerId||void 0,startDate:r.startDate,endDate:r.endDate,status:r.status,notes:r.notes},e=((a=m.getUserById(s.memberId))==null?void 0:a.name)||"member";p.value?(v.updateMembership(p.value.id,s),I.addLog({action:"update",targetType:"membership",targetId:p.value.id,targetName:e,details:`Mengupdate membership "${e}"`})):(v.addMembership(s),I.addLog({action:"create",targetType:"membership",targetId:"",targetName:e,details:`Menambahkan membership baru untuk "${e}"`})),b.value=!1}function q(s){var a;const e=((a=m.getUserById(s.memberId))==null?void 0:a.name)||"member";S.value=`Yakin hapus membership "${e}"? Data yang sudah dihapus tidak bisa dikembalikan.`,x.value=s.id,M.value=!0}function F(){var a;const s=v.memberships.find(d=>d.id===x.value),e=s&&((a=m.getUserById(s.memberId))==null?void 0:a.name)||"member";I.addLog({action:"delete",targetType:"membership",targetId:x.value,targetName:e,details:`Menghapus membership "${e}"`}),v.deleteMembership(x.value)}return(s,e)=>(n(),l("div",ne,[t("div",{class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between"},[e[13]||(e[13]=t("div",null,[t("h1",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},"Membership"),t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Kelola membership member dengan tanggal mulai & berakhir")],-1)),t("button",{onClick:E,class:"btn-primary"},[...e[12]||(e[12]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1),Y(" Tambah Membership ",-1)])])]),t("div",ie,[t("div",de,[u(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>D.value=a),type:"text",class:"input flex-1",placeholder:"ðŸ” Cari member..."},null,512),[[k,D.value]]),u(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>c.value=a),class:"select w-full sm:w-48"},[...e[14]||(e[14]=[G('<option value="all">Semua Status</option><option value="active">Aktif</option><option value="expired">Expired</option><option value="pending">Pending</option><option value="frozen">Frozen</option>',5)])],512),[[y,c.value]])])]),t("div",ue,[t("div",me,[t("table",pe,[e[18]||(e[18]=t("thead",null,[t("tr",{class:"border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50 text-left"},[t("th",{class:"px-5 py-3.5 font-semibold text-gray-600 dark:text-gray-400"},"Member"),t("th",{class:"px-5 py-3.5 font-semibold text-gray-600 dark:text-gray-400"},"Paket"),t("th",{class:"px-5 py-3.5 font-semibold text-gray-600 dark:text-gray-400"},"Trainer"),t("th",{class:"px-5 py-3.5 font-semibold text-gray-600 dark:text-gray-400"},"Mulai"),t("th",{class:"px-5 py-3.5 font-semibold text-gray-600 dark:text-gray-400"},"Berakhir"),t("th",{class:"px-5 py-3.5 font-semibold text-gray-600 dark:text-gray-400"},"Sisa"),t("th",{class:"px-5 py-3.5 font-semibold text-gray-600 dark:text-gray-400"},"Status"),t("th",{class:"px-5 py-3.5 font-semibold text-gray-600 dark:text-gray-400 text-right"},"Aksi")])],-1)),t("tbody",ge,[(n(!0),l(f,null,h(C.value,a=>(n(),l("tr",{key:a.id,class:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors"},[t("td",be,o($(a.memberId)),1),t("td",ve,o(j(a.packageId)),1),t("td",ye,o(z(a.trainerId)),1),t("td",ce,o(i(P)(a.startDate)),1),t("td",xe,o(i(P)(a.endDate)),1),t("td",ke,[a.status==="active"?(n(),l("span",{key:0,class:_(["text-sm font-medium",i(V)(a.endDate)<=7?"text-red-600":"text-emerald-600"])},o(i(V)(a.endDate)>0?`${i(V)(a.endDate)} hari`:"Habis"),3)):(n(),l("span",fe,"-"))]),t("td",he,[t("span",{class:_(["inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium capitalize",i(W)(a.status)])},o(a.status),3)]),t("td",Ie,[t("div",we,[t("button",{onClick:d=>H(a),class:"btn-ghost btn-xs",title:"Edit"},[...e[15]||(e[15]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,De),i(L)?(n(),l("button",{key:0,onClick:d=>q(a),class:"btn-ghost btn-xs text-red-500 hover:text-red-700",title:"Hapus"},[...e[16]||(e[16]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Me)):T("",!0)])])]))),128)),C.value.length===0?(n(),l("tr",Ce,[...e[17]||(e[17]=[t("td",{colspan:"8",class:"px-5 py-12 text-center text-gray-500 dark:text-gray-400"},"Tidak ada membership ditemukan.",-1)])])):T("",!0)])])]),t("div",Ve,"Total: "+o(C.value.length)+" membership",1)]),N(te,{modelValue:b.value,"onUpdate:modelValue":e[10]||(e[10]=a=>b.value=a),title:p.value?"Edit Membership":"Tambah Membership",size:"lg"},{default:J(()=>[t("form",{onSubmit:Z(A,["prevent"]),class:"space-y-4"},[t("div",Se,[t("div",null,[e[20]||(e[20]=t("label",{class:"label"},"Member",-1)),u(t("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>r.memberId=a),class:"select",required:"",disabled:!!p.value},[e[19]||(e[19]=t("option",{value:""},"Pilih member",-1)),(n(!0),l(f,null,h(i(m).members,a=>(n(),l("option",{key:a.id,value:a.id},o(a.name),9,Be))),128))],8,Ue),[[y,r.memberId]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"label"},"Paket",-1)),u(t("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>r.packageId=a),class:"select",required:"",onChange:U},[e[21]||(e[21]=t("option",{value:""},"Pilih paket",-1)),(n(!0),l(f,null,h(i(w).activePackages,a=>(n(),l("option",{key:a.id,value:a.id},o(a.name)+" - "+o(i(X)(a.price)),9,Te))),128))],544),[[y,r.packageId]])])]),t("div",null,[e[24]||(e[24]=t("label",{class:"label"},"Personal Trainer (opsional)",-1)),u(t("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>r.trainerId=a),class:"select"},[e[23]||(e[23]=t("option",{value:""},"Tanpa trainer",-1)),(n(!0),l(f,null,h(i(m).trainers,a=>(n(),l("option",{key:a.id,value:a.id},o(a.name),9,Ne))),128))],512),[[y,r.trainerId]])]),t("div",Pe,[t("div",null,[e[25]||(e[25]=t("label",{class:"label"},"Tanggal Mulai",-1)),u(t("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>r.startDate=a),type:"date",class:"input",required:"",onChange:U},null,544),[[k,r.startDate]])]),t("div",null,[e[26]||(e[26]=t("label",{class:"label"},"Tanggal Berakhir",-1)),u(t("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>r.endDate=a),type:"date",class:"input",required:""},null,512),[[k,r.endDate]])])]),t("div",null,[e[28]||(e[28]=t("label",{class:"label"},"Status",-1)),u(t("select",{"onUpdate:modelValue":e[7]||(e[7]=a=>r.status=a),class:"select"},[...e[27]||(e[27]=[t("option",{value:"active"},"Aktif",-1),t("option",{value:"pending"},"Pending",-1),t("option",{value:"expired"},"Expired",-1),t("option",{value:"frozen"},"Frozen",-1)])],512),[[y,r.status]])]),t("div",null,[e[29]||(e[29]=t("label",{class:"label"},"Catatan",-1)),u(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=a=>r.notes=a),class:"input",rows:"2",placeholder:"Catatan tambahan..."},null,512),[[k,r.notes]])]),t("div",_e,[t("button",{type:"button",onClick:e[9]||(e[9]=a=>b.value=!1),class:"btn-secondary"},"Batal"),t("button",Le,o(p.value?"Simpan":"Tambah"),1)])],32)]),_:1},8,["modelValue","title"]),N(se,{modelValue:M.value,"onUpdate:modelValue":e[11]||(e[11]=a=>M.value=a),message:S.value,onConfirm:F},null,8,["modelValue","message"])]))}});export{Fe as default};
